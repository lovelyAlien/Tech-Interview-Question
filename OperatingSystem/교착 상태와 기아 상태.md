# 교착 상태와 기아 상태

- 교착 상태
- 교착 상태 해결 방법
- 기아 상태
- 교착 상태 vs 기아 상태
- QnA

## 교착 상태 (Deadlock)

- 무한 대기 상태
- 여러 프로세스들이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 다음 단계로 진행하지 못하는 상태

> 스레드 1은 스레드2가 점유하고 있는 자원 2를 대기하고 있고, 스레드 2는 스레드 1이 점유한 자원 1을 대기하고 있다. 
> 각 프로세스(스레드)들이 자원을 점유한 상태에서 서로 다른 프로세스가 점유하고 있는 자원을 요구하며 기다리고 있다. 
> 이것이 **무한 대기 상태인 교착상태**라고 일컫는다.

![image](https://user-images.githubusercontent.com/38436013/131252562-21a6e783-53a9-41c2-8a2f-baf05eb0d9e0.png)

- 멀티 프로그래밍에서 흔히 발생하는 문제, 이를 해결하는 방법은 아직 없다.

  - 멀티 프로그래밍  용어 설명

    > **하나의 프로세서가 (하나의 프로세스를 처리하는 과정에서) 입출력 종료 대기하는 시간을 기다리지 않고, 다른 프로세스를 수행할 수 있도록 하는 것**
    > 초기에는 하나의 프로세서가 하나의 프로세스를 수행하도록 설계됨, 하나의 프로세스 처리하는 과정에서 프로세서의 입출력 처리가 완료될 때까지 기다리는 시간이 생기고, 이것이 비효율적임

- 프로세스, 스레드 둘다 이와 같은 상태가 일어날 수 있음

- 결코 일어나지 않을 사건을 기다리는 무한 대기 -> 기아 상태가 되기도 함

### 교착 상태 발생 조건

네 가지 모두 성립하면 발생 가능하다.

| 조건                         |                                                              |
| ---------------------------- | ------------------------------------------------------------ |
| `상호배제(Mutual exclusion)` | 한번에 한개의 프로세스만이 공유 자원을 사용                  |
| `점유대기(Hold and wait)`    | 프로세스가 자원을 점유한 상태에서 다른 프로세스가 점유한 자원을 대기 |
| `비선점(No preemption)`      | 자원 점유에 대한 통제권을 빼앗지 못하는 것                   |
| `순환대기(Circular wait)`    | 공유 자원 사용하기 위해 프로세스들이 원형으로 구성되어 있어, <br />각 프로세스는 자원을 점유한 상태에서 앞이나 뒤에 있는 프로세스의 자원을 요구하는 형태 |



## 교착 상태 해결 방법

- 교착 상태 예방
- 교착 상태 회피
- 교착 상태 발견
- 교착 상태 회복

### 교착 상태 예방

- 4가지 조건 중 하나를 제거하는 방법

1. 상호 배제 조건의 제거: 한 번에 여러 프로세스가 공유 자원에 접근 가능
2. 점유와 대기 조건의 제거: 프로세스 실행되기 전 필요한 모든 자원 할당하여 대기 상태 없앰
3. 비선점 조건 제거: 선점 가능 기법을 만들어줌
4. 순환 대기 조건 제거: 선형 순서로 나열하여 자원에 순서를 부여

### 교착상태 회피

- 교착 상태가 발생할 가능성 배제하지 않고, 발생하면 피해나가는 방법으로 은행원 알고리즘이 사용된다.

- 은행원 알고리즘

  [자세히 살피기](https://mfamcs.netlify.app/docs/ca_and_os/%EA%B5%90%EC%B0%A9%20%EC%83%81%ED%83%9C/)

  > 1. 다익스트라가 제안한 기법으로, 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는 기법
  > 2. 각 프로세스에게 자원을 할당하여 교착 상태가 발생하지 않도록 하며, 안정 상태(모든 프로세스가 완료될 수 있는 상태), 불안정 상태(교착 상태가 발생 가능한 상태)가 있다.
  > 3. 자원의 양과 프로세스 수가 일정해야 한다.
  > 4. 프로세스의 모든 요구를 유한한 시간안에 할당하는 것을 보장

  - 은행원 알고리즘은 교착 상태를 회피하는 기법으로, 복잡하고 오버헤드가 커서 현재 적용되지 않는 방식이다.

### 교착 상태 발견

- 교착상태가 발생했는지 점검하여 교착 상태에 있는 프로세스와 자원을 발견하는 것
- 교착 상태 알고리즘(?)으로 교착 상태 발생을 체크하는 방식이다.

### 교착 상태 회복

- 교착 상태를 일으킨 프로세스를 종료하거나 교착상태의 프로세스에 할당 된 자원을 선점하여 프로세스나 자원을 회복하는 것



## 기아 상태 (Starvation)

- 우선 순위 낮아서 원하는 자원을 할당 받지 못하는 상태
- 특정 프로세스는 영원히 자원을 할당받지 못함
- 우선 순위 스케줄링 알고리즘에서 주로 발생

### 기아 상태 해결 방법

- `에이징 기법`
  -  우선 순위가 낮은 프로세스의 우선 순위를 높여줘서 문제 해결
  - 예 : 다단계 피드백 큐 스케줄링 기법
- 요청 순서대로 fifo 기반 요청



## 교착 상태 vs 기아 상태

교착 상태와 기아 상태는 **프로세스 실행을 차단하여 지연**시키는 공통점이 있다.

- `교착 상태(데드락)`
  - 교착상태는 여러 프로세스들이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 다음 단계로 진행하지 못하는 상태
  - 원인 : 제한된 자원을 할당한 결과로 일어난 부작용(한정된 공유 자원 사용으로 인한 부작용)
  - 해결 방안 : 운영체제가 교착상태를 해결하지 못하면 시스템 운영자나 사용자는 작업을 교체하거나 종료하는 외부 간섭으로 이를 해결해야 한다.
  - **교착 상태는 기아 상태가 됨, 그 역은 안됨**
- `기아`
  - 우선순위 낮은 프로세스는 영원히 자원 할당이 안되는 경우를 주로 의미함
  - 원인 : 기다리는 결과를 개선하기 위해 자원 할당할때 발생한 부작용
  - 해결 방안 : 우선순위 높인다.



## QnA

- 교착 상태란 무엇인가?
- 교착 상태의 4가지 조건은 무엇이며, 각각 어떤 역할을 하는가?
- 교착 상태의 해결방법에는 어떤 것들이 있는가?
- 교착 상태와 기아 상태를 비교하여 설명하시오(공통, 차이)
- 기아 상태를 해결하는 방법은 무엇인가?



### Reference

- https://velog.io/@sdk1926/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C%EC%99%80-%EA%B8%B0%EC%95%84%EC%83%81%ED%83%9C

- https://mfamcs.netlify.app/docs/CA_and_OS/%EA%B5%90%EC%B0%A9%20%EC%83%81%ED%83%9C

- https://coding-factory.tistory.com/311

- https://sorjfkrh5078.tistory.com/56